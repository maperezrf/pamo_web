{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{info.name|slice:"1:"}}{% if info.customer.displayName %}-{{ info.customer.displayName }}{% endif %}</title>
    <style>
        @page {
            size: A4;
            margin: 0;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #fff; /* Color de fondo */
        } 

        .page {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .page:nth-child(odd) {
            background-color: #F2F2F2;
        }
        .header{
            display:block;
        }
        .insignia {
            width: 55px;
            margin-left: 890px;
        }
        .logo{
            width:50px;
        }
        .compani-info{
            display:flex;
        }
        .texto-derecha {
            text-align: right;
        }
        .bg{
            width:1131px;
            height:1600px
        }
        .container {
            position: relative;
        }
        .overlay-text {
            position: relative;
            width: 1080px;
            margin-top: 100px;
            margin-left: -85px;
        }

        .info-customer {
            display: flex;
            justify-content: space-between;
            padding: 0px 81px;
            padding-bottom: 13px;
        }

        .product-table  {
            border-collapse: collapse;
            width: 990px;
            margin: auto;
            min-height: 790px;
        }
        .product-table td{
            vertical-align: top;
        }
        .product-table tr{
            min-height: 40px;
            border-bottom: 1px solid #d1d1d1;
        }
        th, td {
            text-align: left;
            padding: 8px;
        } 
        th {
            background-color: #d1d1d1; 
            color: black; 
        }
        th:not(:first-child) {
            border-left: 1px solid withe;
        }

        .column {
            flex: 1;
            padding: 8px;
            border-right: 1px solid white ; 
        }
        .linea-vertical {
            position: absolute;
            top:544px;
            bottom: 455px;   
            width: 1px;
            background-color: #d1d1d1; 
        }
        .l1{
            left:171px; 
        }
        .l2{
            left:325px; 
        }
        .l3{
            left:677px; 
        }
        .l4{
            left:798px;
            bottom : 350px 
        }
        .l5{
            left:930px; 
            bottom : 350px 
        }
        .btns{
            font-size: 13px;
            width: 100%;
            padding-left: 51px;
        }
        .btns img{
            height: 30px;
            width: auto;
        }

        .politics{
            left: 80px;
            font-size: 13px;
            width: 974px;
            margin: auto;
        }

        .linea-horizontal {
            border-top: 1px solid;
            width: 990px;
            color: #d1d1d1;
            margin: 10px auto;
        }
        
        .lh1{
            bottom: 453px;
        }

        .lh2{
            bottom: 255px;
        }

        .totales{
            display: flex;
            margin-right: 81px;
        }

        .totales p{
            margin: 2px;
        }

        .img-product{
            width:100%;
            height:auto
        }
        .back {
            width: 1080px;
            height: 1528px;
            background-size: cover;
            background-repeat: no-repeat;
        }
        
        .pg1{ 
        background-image: url('{% static "images/cotizacion/Pg1.png" %}')
        }
        .pg2{ 
        background-image: url('{% static "images/cotizacion/Pg2.png" %}')   
        }
        .pg3{ 
        background-image: url('{% static "images/cotizacion/Pg3.png" %}')
        }

        .cont_ends {
            display: flex;
            justify-content: space-between; /* Distribuye los elementos a los extremos del contenedor */
        }


    </style>
</head>
<body>
    <div class="page">
        <div class='back pg1' >
        </div> 
    </div>
    <div class="page">
        <div class='back pg2' >
        </div>
    </div>
    <div class="page" id='cotizacion'>
        <div class='back pg3' >
        <div class="container">
            <div class="overlay-text">
                <p class="texto-derecha">FEPRIN SAS / PAMO.CO<br>
                    NIT: 900.382.733-3 Régimen Común<br>
                    Actividad Económica 4752 Tarifa Renta 0,40%<br>
                    AV CARACAS No 66 - 67 BOGOTA - D.C.<br>
                    Teléfonos: (601)9168880 3124875756<br><br>
                    No somos Autoretenedores - No somos Grandes Contribuyentes<br>
                    Régimen IVA: COMÚN Actividad ICA: 47521 6,90x mil</p>
            </div>
            <div class= 'info-customer'>
                <p>{% if info.customer.displayName %}  <strong>Nombre / Empresa:</strong> {{info.customer.displayName|title}} <br><br> {% endif %}
                    {% if info.customer.email %} <strong>Correo:</strong> {{info.customer.email}} <br><br> {% endif %}
                    {% if nit %} <strong>Nit:</strong> {{nit}} <br><br> {% endif %}
                    {% if info.customer.defaultAddress.phone %} <strong>Teléfono:</strong> {{info.customer.defaultAddress.phone|cut:"0123456789"}} <br><br> {% endif %}
                    Plazo: 10 dias Fecha de Vencimiento: {{plazo}}
                </P>
                <p>Teléfono: 316 7578855</P>
                <p class="texto-derecha">Fecha: <u>{{update}}/</u><br><br>Cotización No. {{info.name|slice:"1:" }}</P>
            </div>
            <div>
                <table class="product-table" id="product-table">
                    <thead>
                        <tr>
                            <th class="column" style="width: 74px;">FOTO</th>
                            <th class="column" style="padding: 8px 60px;">SKU</th>
                            <th class="column" style="padding: 8px 120px;">DESCRIPCIÓN</th>
                            <th class="column" style="width: 104.4px;" >CANTIDAD</th>
                            <th class="column" style="width: 114.9px;">P. UNITARIO</th>
                            <th class="column" style="width: 90.65px;">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% comment %} <script>
                            var total = 0
                        </script>
                        <tr>
                            {% for i in info.lineItems.edges %}
                            <td><img class='img-product' src= {% if i.scr %} {{i.scr}} {% else %} "{% static 'images/Logo Pamo Png.png' %}"  {% endif %}  alt ="No photo"></td>
                            <td>{{i.sku}}</td>
                            <td>{{i.node.title}}</td>
                            <td>{{i.node.quantity}}</td>
                            <td>
                                <script>                        
                                    document.write((parseInt({{ i.node.originalUnitPrice }} /1.19).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0})).replace("COP", "$"));
                                </script>
                            </td>
                            <td>
                                <script>
                                    var price_cant = parseInt(({{ i.node.quantity }}/1.19) * {{ i.node.originalUnitPrice }})
                                    document.write(price_cant.toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$"));
                                    total = total + price_cant
                                    var total_iva = total * 0.19
                                </script>
                            </td>
                        </tr>
                        {% endfor %}
                    </tr> {% endcomment %}
                </tbody>
            </table>
            <div id = "footer">
                <div class = 'cont_ends' >
                    <div class='btns'>
                        <p>Ahora puedes pagar tus compras en linea con WOMPI. Edita tus datos de envío y facturación, selecciona la<br>opción de transferencia y elige entre Bancolombia o Davivienda.</p>
                        <a href="{{info.invoiceUrl}}"> <img src="{% static 'images/cotizacion/Bot-pago.png' %}" width='30px' alt="boton pago"></a>
                        <p>Comunicate directamente con nosotros si tienes dudas o deseas hacer alguna modificación</p>
                        <img src="{% static 'images/cotizacion/bton-W.png' %}" width= '30px' alt="boton w">
                    </div>
                    <div class= "totales">
                        <div class='texto-derecha' style = "margin-right: 10px;">
                            <p><strong>Subtotal</strong></p>
                            <p><strong>IVA</strong></p>
                            {% if info.appliedDiscount.amount %}<p><strong>Descuento</strong> {% endif %}
                                <p><strong>Total</strong></p>
                        </div>
                        <div>
                            <p><script>
                                document.write(total.toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$"))
                            </script></p>
                            <p><script> document.write(parseInt(total_iva).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$")) </script> </p>
                            <p> {% if info.appliedDiscount.amount %}<script> 
                                var discount ={{info.appliedDiscount.amount}}
                                document.write( discount.toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$ -")) </script> </p> {% endif %}</p>
                            <p> {% if info.appliedDiscount.amount %} <script> document.write((parseInt(total_iva) + parseInt(total) - parseInt(discount)).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$"))</script>
                                {% else %} <script>document.write((parseInt(total_iva) + parseInt(total)).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$")) </script> {% endif %}</p></p>
                        </div>
                    </div>
                </div>
                <div class="linea-horizontal"></div>
                <div class= 'politics'>
                <p>
                    POLITICAS DE REEMBOLSO DE FREPIN SAS<br>
                    Consulta nuestra politica de reembolso https://www.pamo.co/policies/refund-policy<br>
                    <span style='text-align: justify;' >
                    Todas las devoluciones y/o garantías estarán sujetas al derecho de retracto y a la política de garantías por lo que toda solicitud debe ser notificada por el correo lidercomercial1@pamo.co, en el tiempo establecido por PAMO COLOMBIA que equivalen a treinta (30) días fecha calendario a partir de que el cliente tenga el producto. Si la garantía de
                    tu producto es procedente, se realizará la reparación pertinente totalmente gratuita de los defectos del bien y se suministrará oportunamente los repuestos requeridos siempre
                    y cuando el producto cumpla con los siguientes requisitos: 1. El producto de venir correctamente embalado 2. El producto debe venir limpio y desinfectado (sin ningún tipo de
                    residuo) previamente antes de ser recibido. PORFAVOR CONSERVE EL EMPAQUE Y GUIAS DEL PRODUCTO PARA SU RESPECTIVA GARANTIA YA QUE EL PRODUCTO PUDO VERSE
                    AFECTADO POR EL MALTRATO EN SU EMBALAJE.
                    POLITICAS DE PRIVACIDAD DE FREPIN SAS
                    Consulta nuestra politica de Privacidad</span>
                </p>
            </div>
        </div>
    </div>
    </div>
</body>
</html>
<script>
    window.onload = function() {
        var elemento = document.getElementById("cotizacion");
        if (elemento) {
          elemento.scrollIntoView();
        }
        
        footer = document.getElementById('footer')

          json = "{{info|safe}}".replace(/'/g, '"')
          json = json.replace(/None/g, 'null')
          data = JSON.parse(json).lineItems.edges
          data.forEach(function(element){
            console.log(element.sku)
          })

          var table = document.getElementById('product-table')
          var tbody = table.getElementsByTagName('tbody')[0];
          data.forEach(function(item) {
            var row = tbody.insertRow();
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
        
            imagen = document.createElement('img')
            imagen.src = item.scr == undefined ? "{% static 'images/Logo Pamo Png.png' %}": item.scr;
            imagen.width = 75; 
            imagen.height = 75;
            //cell1.appendChild(imagen)
            //cell2.innerHTML = item.sku == undefined ? "": item.sku
            //cell3.innerHTML = item.node.title == undefined ? "": item.node.title
            //cell4.innerHTML = item.node.quantity == undefined ? "": item.node.quantity
            //vUnit = item.node.originalUnitPrice/1.19
            //cell5.innerHTML = item.node.originalUnitPrice == undefined ? "": formatNumber(vUnit)
            //totalItem = item.node.originalUnitPrice/1.19 * item.node.quantity
            //cell6.innerHTML = item.node.originalUnitPrice == undefined ? "": formatNumber(totalItem)

        });

        function formatNumber(number){
            return (number).toLocaleString('es-CO', {
                style: 'currency',
                currency: 'COP'
            }).replace(/,\d{2}/g,'');
        }



        var limit = 10
        const rowGroups = [];
        let currentGroup = [];
        let rowCount = 0;
        for (const row of data) {
            currentGroup.push(row);
            rowCount++;
            if (rowCount >= limit) {
              rowGroups.push(currentGroup);
              currentGroup = [];
              rowCount = 0;
            }
          }
          if (currentGroup.length > 0) {
            rowGroups.push(currentGroup);
          }
        console.log(data.length)
        console.log(rowGroups)
        rowGroups.forEach((group, index) => {
            console.log(index)
            divPage = document.getElementById('cotizacion');
            var divPageAdd = divPage.cloneNode(true);
            divPageAdd.id = 'cotizacion_' + index.toString()
            group.forEach((row) => {
                document.body.appendChild(divPageAdd);
        });
        
        //divPage = document.getElementById('cotizacion');
        //var divPageAdd = divPage.cloneNode(true);
        //document.body.appendChild(divPageAdd);
        });
    };
      
</script>

























{% comment %} {% load static %}
    <style>
        @media print {
            @page {
                margin: 0;
            }
            body::before {
                content: "";
                display: none;
            }
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .header img {
            max-width: 150px;
            margin-right: 20px;
        }

        .company-info {
            flex-grow: 1;
        }

        .company-info p {
            margin: 0;
            font-size: 14px;
        }

        .customer-quote {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            border: 1px solid black; /* Línea que separa cliente y cotización */
            padding: 10px;
        }

        .customer-info,
        .quote-info {
            flex-basis: 335px;
        }

        .quote-info {
            margin-left: 0px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #ccc;
        }
        .cont_ends {
        display: flex;
        justify-content: space-between;
        }

        p {
            display: block;
            margin-block-start: 0;
            margin-block-end: 0;
            margin-inline-start: 0px;
            margin-inline-end: 0px;
        }

        .totals {
            margin-top: 20px;
            text-align: right; 
        }

        .payment-methods {
           margin-top: 20px;
           text-align: left;
           width: 570px;
        }
        .cont_ends p{
            margin: 5px;  
            width: 300x;
        }
        .header img {
            max-width: 300px;
            margin-right: 20px;
        }
        .img_pago{
            max-width: 100px;
        }
        .image_pay {
            display: block;
            margin: 0 auto;
            width: 150px;
        }
        .menu {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .menu a {
            text-align: center;
            margin: 50px;
            text-decoration: none;
            color: #333;
        }

        .menu img {
            display: block;
        }

        @media print {
            .menu {
                display: none;
            }
        }
</style> {% endcomment %}

{% comment %} 
    <div class="container" id="contenido-popup">
        <div class="header">
            <img src="{% static 'images/Logo Pamo Png.png' %}" width="400px" alt="Logo de FEPRIN SAS">
            <div class="company-info">
                <p>FEPRIN SAS</p>
                <p>PAMO.CO</p>
                <p>NIT: 900.382.733-3 RÉGIMEN COMÚN</p>
                <p>Actividad Económica 4752 Tarifa Renta 0,40%</p>
                <p>AV CARACAS Nº 66 - 67 BOGOTA - D.C.</p>
                <p>Teléfonos: (601)9168880 3124875756</p>
                <p>No somos Autoretenedores - No somos Grandes Contribuyentes</p>
                <p>Régimen IVA: COMÚN Actividad ICA: 47521 6,90x mil</p>
            </div>
        </div>
        <div class="customer-quote">
            <div class="customer-info">
                {% if nit %}<p> <strong>Nit:</strong> {{nit}}</p> {% endif %}
                {% if info.customer.defaultAddress.company %}<p>  <strong>Empresa:</strong> {{ info.customer.defaultAddress.company|title}} {% else %}</p> {% endif %}
                {% if info.customer.displayName %} <p> <strong>Nombre Cliente:</strong> {{info.customer.displayName|title}} {% endif %}
                {% if info.defaultAddress.address1 %}<p> <strong>Dirección:</strong> {{info.default_address.address1|title}}</p> {% endif %}
                {% if info.customer.email %}<p> <strong>Correo:</strong> {{info.customer.email}} {% else %}</p> {% endif %}
                {% if info.customer.defaultAddress.phone %}<p> <strong>Teléfono:</strong> {{info.customer.defaultAddress.phone}} </p>{% endif %}
            </div>
            <div class="quote-info">
                <p><strong>Número de Cotización:</strong> {{info.name}}</p>
                <p><strong>Fecha:</strong> {{update}}</p>
                <p><strong>Plazo:</strong> 10 dias</p>
                <p><strong>Fecha de Vencimiento:</strong> {{plazo}}</p>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Foto</th>
                    <th>SKU</th>
                    <th>Descripción</th>
                    <th>Cantidad</th>
                    <th>Costo Unitario</th>
                    <th>Costo Total</th>
                </tr>
            </thead>
            <tbody>
                <script>
                    var total = 0
                </script>
                <tr>
                    {% for i in info.lineItems.edges %}
                    <td><img src= {% if i.scr %} {{i.scr}} {% else %} "{% static 'images/Logo Pamo Png.png' %}" width = 80px   {% endif %} alt="No photo" width="40"></td>
                    <td>{{i.sku}}</td>
                    <td>{{i.node.title}}</td>
                    <td>{{i.node.quantity}}</td>
                    <td>
                        <script>                            
                            document.write((parseInt({{ i.node.originalUnitPrice }} /1.19).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0})).replace("COP", "$"));
                        </script>
                    </td>
                    <td>
                        <script>
                            var price_cant = parseInt(({{ i.node.quantity }}/1.19) * {{ i.node.originalUnitPrice }})
                            document.write(price_cant.toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$"));
                            total = total + price_cant
                            var total_iva = total * 0.19
                        </script>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class = cont_ends>
            <div class="payment-methods">
                <p>Por favor ingresa al enlace del pedido y completa la información de envío y facturación. El sistema calculará los costos de envío si son aplicables.</p>
                <a href="{{info.invoiceUrl}}"> <img class="image_pay"  src="{% static 'images/pague aqui.png' %}" ></a>
            </div>
            <div class="totals">
                <p><strong> Subtotal: </strong> 
                    <script>
                        document.write(total.toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$"))
                    </script>
                </p>
                <p><strong>IVA:</strong> <script> document.write(parseInt(total_iva).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$")) </script> </p>
                
                {% if info.appliedDiscount.amount %}<p><strong>Descuento:</strong> <script> 
                    var discount ={{info.appliedDiscount.amount}}
                    document.write( discount.toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$ -")) </script> </p> {% endif %}
                <p><strong>Total:</strong> {% if info.appliedDiscount.amount %} <script> document.write((parseInt(total_iva) + parseInt(total) - parseInt(discount)).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$"))</script>
                    {% else %} <script>document.write((parseInt(total_iva) + parseInt(total)).toLocaleString('en-GB', {style: 'currency',currency: 'COP', minimumFractionDigits: 0}).replace("COP", "$")) </script> {% endif %}</p>
            </div>
        </div>
    </div>  
        <div class="menu">
            <a href="#">
                <img id="botonImprimir" src="{% static 'images/descarga.png' %}" width="50" alt="Imprimir">
                <span>Imprimir</span>
        </div> 
<script>
    document.getElementById('botonImprimir').addEventListener('click', function() {
        window.print();
    });
</script>  {% endcomment %}