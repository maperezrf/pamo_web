{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>{{info.name|slice:"1:"}}{% if info.customer.displayName %}-{{ info.customer.displayName }}{% endif %}</title>
    <link href="{% static 'css/cotizacion_style.css' %}" rel="stylesheet">
    <meta charset="UTF-8">
    <style>
        .pg1{ 
        background-image: url('{% static "images/cotizacion_img/Pg1.png" %}')
        }

        .pg2{ 
        background-image: url('{% static "images/cotizacion_img/Pg2.png" %}')   
        }

        .pg3{ 
        background-image: url('{% static "images/cotizacion_img/Pg3.png" %}')
        }
    </style>
</head>
<div>
    <div class="page container">
        <div class='back pg1'>
        </div>
    </div>
    <div class="page">
        <div class='back pg2'>
        </div>
    </div>
    <div class="page" id='cotizacion'>
        <div class='back pg3'>
            <div class="container">
                <div class="overlay-text">
                    <p class="texto-derecha">FEPRIN SAS / PAMO.CO
                        <br> NIT: 900.382.733-3 Régimen Común
                        <br> Actividad Económica 4752 Tarifa Renta 0,40%
                        <br> AV CARACAS No 66 - 67 BOGOTA - D.C.
                        <br> Teléfonos: (601)9168880 3124875756
                        <br>
                        <br> No somos Autoretenedores - No somos Grandes Contribuyentes
                        <br> Régimen IVA: COMÚN Actividad ICA: 47521 6,90x mil</p>
                </div>
                <div class='info-customer'>
                    <p>{% if info.customer.displayName %} <strong>Nombre / Empresa:</strong> {{info.customer.displayName|title}}
                        <br>
                        <br> {% endif %} {% if info.customer.email %} <strong>Correo:</strong> {{info.customer.email}}
                        <br>
                        <br> {% endif %} {% if nit %} <strong>Nit:</strong> {{nit}}
                        <br>
                        <br> {% endif %} {% if info.customer.defaultAddress.phone %} <strong>Teléfono:</strong> {{info.customer.defaultAddress.phone|cut:"0123456789"}}
                        <br>
                        <br> {% endif %} Plazo: 10 dias Fecha de Vencimiento: {{plazo}}
                    </P>
                    <p>Teléfono: 316 7578855</P>
                    <p class="texto-derecha">Fecha: <u>{{update}}/</u>
                        <br>
                        <br>Cotización No. {{info.name|slice:"1:" }}</P>
                </div>
                <div>
                    <table class="product-table" id="product-table">
                        <thead>
                            <tr>
                                <th class="column H5" style="width: 70px;">FOTO</th>
                                <th class="column" style="padding: 8px 40px;">SKU</th>
                                <th class="column" style="padding: 8px 90px;">DESCRIPCIÓN</th>
                                <th class="column" style="width: 104.4px;">CANTIDAD</th>
                                <th class="column" style="width: 114.9px;">P. UNITARIO</th>
                                <th class="column" style="width: 90.65px;">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div id="footer">
                        <div class='cont_ends'>
                            <div class='btns'>
                                {% comment %} {% if info.appliedDiscount.title %}
                                <p>{{ info.appliedDiscount.title }}</p> {% endif %} {% endcomment %}

                                <p> <strong> Realizar el pago a nombre de FEPRIN SAS,  NIT 900382733. </strong>
                                    <br>
                                    <br>
                                    <a href="http://link.mercadopago.com.co/pamocolombia" target="_blank" ><img src="{% static 'images/cotizacion_img/Bot-pago.png' %}" width='30px' alt="boton pago"></a>
                                    <strong>Bancolombia Cuenta de Ahorros No. 174-000021-78</strong></p>
                                    <a href= "{{ url }}" target="_blank"><img src="{% static 'images/cotizacion_img/wp.svg' %}" width='30px' alt="boton w"></a>
                                    <a href="https://cdn.shopify.com/s/files/1/0617/8507/9974/files/RUT_COMPLETO_FEPRIN_SAS.pdf?v=1713496670" target="_blank"><img src="{% static 'images/cotizacion_img/rut.svg' %}" width='30px' alt="rut"></a>
                                    <a href="https://cdn.shopify.com/s/files/1/0617/8507/9974/files/CERTIFICACION_FEPRIN_BANCOLOMBIA.pdf?v=1713496669" target="_blank"><img src="{% static 'images/cotizacion_img/certificacion.svg' %}" width='30px' alt="certificado"></a>

                            </div>
                            <div class="totales">
                                <div class='texto-derecha' style="margin-right: 10px; min-width: 100px;">
                                    <p class="font-weight-bold">Total bruto</p>
                                    {% if info.appliedDiscount.amount %}<p id='percent' class="font-weight-bold">Descuento</p> {% endif %}
                                    <p class="font-weight-bold">Subtotal</p>
                                    <p class="font-weight-bold">IVA</p>
                                    <p class="font-weight-bold">Total</p>
                                </div>
                                <div>
                                    <p id='total-bruto'></p>
                                    {% if info.appliedDiscount.amount %}<p id='descuento'></p>{% endif %}
                                    <p id='subtotal'></p>
                                    <p id='iva'></p>
                                    <p id='total'></p>
                                </div>
                            </div>
                        </div>
                        <div class="linea-horizontal"></div>
                        <div class='politics'>
                            <p style="width: 800px;margin: 0 auto;">
                                POLITICAS DE REEMBOLSO DE FEPRIN SAS
                                <br> Consulta nuestra politica de reembolso https://www.pamo.co/policies/refund-policy
                                <br>
                                <span style='text-align: justify;'>
                                    Todas las devoluciones y/o garantías estarán sujetas al derecho de retracto y a la política de garantías por lo que toda solicitud debe ser notificada por el correo ventas@pamo.co, en el tiempo establecido por PAMO COLOMBIA que equivalen a treinta (30) días fecha calendario a partir de que el cliente tenga el producto. Si la garantía de
                                    tu producto es procedente, se realizará la reparación pertinente totalmente gratuita de los defectos del bien y se suministrará oportunamente los repuestos requeridos siempre
                                    y cuando el producto cumpla con los siguientes requisitos: 1. El producto de venir correctamente embalado 2. El producto debe venir limpio y desinfectado (sin ningún tipo de
                                    residuo) previamente antes de ser recibido. PORFAVOR CONSERVE EL EMPAQUE Y GUIAS DEL PRODUCTO PARA SU RESPECTIVA GARANTIA YA QUE EL PRODUCTO PUDO VERSE
                                    AFECTADO POR EL MALTRATO EN SU EMBALAJE.
                                    POLITICAS DE PRIVACIDAD DE FEPRIN SAS
                                    Consulta nuestra politica de Privacidad
                                </span>
                            </p>
                            <a href="#" class='boton-imagen' id="botonImprimir">
                                <img src="{% static 'images/descarga.png' %}" width="50" alt="Imprimir">
                                <span>Imprimir</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

</html>
<script src="{% static 'js/functions.js' %}"></script>
<script>

    window.onload = function() {
  
    document.getElementById('botonImprimir').addEventListener('click', function() {
        window.print();
        });

      var elemento = document.getElementById("cotizacion");
      if (elemento) {
        elemento.scrollIntoView();
      }
      totales = {}
      totales.totalSinIva = 0
      totales.total = 0
      total = 0

      json = {'info': {'id': 'gid://shopify/DraftOrder/1203036029205', 'name': '#D5100', 'totalPrice': '6876659.40', 'createdAt': '2025-06-19T16:26:53Z', 'updatedAt': '2025-06-19T16:37:08Z', 'appliedDiscount': {'amount': '1509510.60', 'title': ''}, 'customer': {'displayName': 'VIVVI SAS', 'email': 'facturacion.vivvidero@gmail.com', 'defaultAddress': {'company': 'VIVVI SAS', 'phone': '+57 311 7763671'}, 'metafields': {'edges': [{'node': {'key': 'tipo_de_documento', 'value': ''}}, {'node': {'key': 'numero_documento_identificaci_n', 'value': ''}}, {'node': {'key': 'tipo', 'value': '["Empresa"]'}}]}}, 'invoiceUrl': 'https://www.pamo.co/61785079974/invoices/85f36f2b89eed0b25237b1acd13bdef5', 'lineItems': {'edges': [{'node': {'title': 'Grifería Para Lavaplatos Cuello Cisne Negra', 'originalUnitPrice': '103760.00', 'quantity': 10, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_7cfbf6ca-12c4-45ba-9edb-d408f16bb370.jpg?v=1743629364'}}]}, 'variants': {'edges': [{'node': {'sku': 'BC001'}}]}}}, 'sku': 'BC001', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_7cfbf6ca-12c4-45ba-9edb-d408f16bb370.jpg?v=1743629364'}, {'node': {'title': 'Grifería Poste Alto Negra para Lavamanos - Agua Fría, 1/2~ Universal', 'originalUnitPrice': '55802.00', 'quantity': 15, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_7f7c903d-979e-4843-85f3-bbea13e43170.jpg?v=1749093796'}}]}, 'variants': {'edges': [{'node': {'sku': 'PAC5925BL'}}]}}}, 'sku': 'PAC5925BL', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_7f7c903d-979e-4843-85f3-bbea13e43170.jpg?v=1749093796'}, {'node': {'title': 'griferia sencilla alta cromo ', 'originalUnitPrice': '63325.00', 'quantity': 15, 'product': None}}, {'node': {'title': 'Grifería Lavamanos Poste Bajo Rio Agua Fria', 'originalUnitPrice': '46527.00', 'quantity': 10, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/IMG-0169.jpg?v=1717873143'}}]}, 'variants': {'edges': [{'node': {'sku': '5693;PAC5924BLACK'}}]}}}, 'sku': '5693;PAC5924BLACK', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/IMG-0169.jpg?v=1717873143'}, {'node': {'title': 'griferia sencilla baja cromo ', 'originalUnitPrice': '58160.00', 'quantity': 10, 'product': None}}, {'node': {'title': 'Regadera Redonda 25 cm Negra + Tubo', 'originalUnitPrice': '83383.00', 'quantity': 10, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/4_dbec6130-f572-4662-9dff-7eb66c1ce29f.png?v=1703619793'}}]}, 'variants': {'edges': [{'node': {'sku': '16165170'}}]}}}, 'sku': '16165170', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/4_dbec6130-f572-4662-9dff-7eb66c1ce29f.png?v=1703619793'}, {'node': {'title': 'Regadera Acero Ultraplana 25 cms Redonda Alta Calidad Sin Tubo', 'originalUnitPrice': '59299.00', 'quantity': 7, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/PAMO_SR010.jpg?v=1743124757'}}]}, 'variants': {'edges': [{'node': {'sku': 'PAMO_SR010'}}]}}}, 'sku': 'PAMO_SR010', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/PAMO_SR010.jpg?v=1743124757'}, {'node': {'title': 'Tubo Regadera 40 cm Tipo L Acero inoxidable', 'originalUnitPrice': '20006.00', 'quantity': 7, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_d7dd323d-7c70-4258-b8ed-c9e99eed066c.jpg?v=1709388453'}}]}, 'variants': {'edges': [{'node': {'sku': 'DF-1001'}}]}}}, 'sku': 'DF-1001', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_d7dd323d-7c70-4258-b8ed-c9e99eed066c.jpg?v=1709388453'}, {'node': {'title': 'monocontrol lavamanos alto redondo cromo', 'originalUnitPrice': '94600.00', 'quantity': 7, 'product': None}}, {'node': {'title': 'Grifería Lavamanos Monocontrol Cromada Poste Alto Original Pamo', 'originalUnitPrice': '112626.00', 'quantity': 5, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_82bd520f-d0c4-4f70-b6de-32bdb11b15d9.jpg?v=1740433997'}}]}, 'variants': {'edges': [{'node': {'sku': 'PAMO_F10008H'}}]}}}, 'sku': 'PAMO_F10008H', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_82bd520f-d0c4-4f70-b6de-32bdb11b15d9.jpg?v=1740433997'}, {'node': {'title': 'poste monocontrol alto cuadrado', 'originalUnitPrice': '98600.00', 'quantity': 5, 'product': None}}, {'node': {'title': 'acople str 40 cm ', 'originalUnitPrice': '6200.00', 'quantity': 20, 'product': None}}, {'node': {'title': 'sifon lavaplatos en p blanco ', 'originalUnitPrice': '14400.00', 'quantity': 15, 'product': None}}, {'node': {'title': 'Sifon Flexible Para Lavaplatos O Lavamanos Blanco.', 'originalUnitPrice': '21860.00', 'quantity': 20, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/products/D_955363-MCO31061938384_062019-F.jpg?v=1694193036'}}]}, 'variants': {'edges': [{'node': {'sku': 'F6101-1'}}]}}}, 'sku': 'F6101-1', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/products/D_955363-MCO31061938384_062019-F.jpg?v=1694193036'}, {'node': {'title': 'Desague Push Lavamanos Negro Metálico Lujo Universal Diseño Moderno', 'originalUnitPrice': '31515.00', 'quantity': 20, 'product': {'images': {'edges': [{'node': {'originalSrc': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_8eaf1c88-99d6-42a3-b452-32ba15f853cc.jpg?v=1748267562'}}]}, 'variants': {'edges': [{'node': {'sku': '16164783'}}]}}}, 'sku': '16164783', 'scr': 'https://cdn.shopify.com/s/files/1/0617/8507/9974/files/1_8eaf1c88-99d6-42a3-b452-32ba15f853cc.jpg?v=1748267562'}]}}, 'plazo': '29/06/2025', 'update': '19/06/2025', 'nit': None, 'url': 'https://api.whatsapp.com/send?phone=576019142738&text=Hola,%20deseo%20revisar%20mi%20cotización%20D'}
      json = json.replace(/None/g, 'null');
      datos = JSON.parse(json);
      data = JSON.parse(json).lineItems.edges;
      data.forEach(function(element) {
      totales.total += (element.node.originalUnitPrice * element.node.quantity)
      totales.bruto =  totales.total/1.19
      element.node.title = element.node.title.replace('~', '\"')
        });
        totales.total = datos.totalPrice
        totales.totalSinIva = totales.total - totales.iva
        totales.subtotal = datos.totalPrice/1.19  
        totales.subTotalSinIva = totales.subtotal * 0.19 
        totales.descuento =  totales.bruto - totales.subtotal
        totales.percent = Math.round((totales.descuento/totales.bruto) * 100, 0)
        document.getElementById('total-bruto').textContent =  formatNumber(totales.bruto)
        document.getElementById('descuento') == null ? '' : document.getElementById('descuento').textContent = formatNumber(parseFloat(totales.descuento))
        document.getElementById('subtotal').textContent = formatNumber(parseFloat(totales.subtotal))
        document.getElementById('iva').textContent =  formatNumber(parseFloat(totales.subTotalSinIva))
        document.getElementById('total').textContent =  formatNumber(parseFloat(totales.total))
        if (datos.appliedDiscount){
            document.getElementById('percent').textContent +=  ` ${totales.percent}%`
        }
        

      function setTable(table, data) {
        var tbody = table.getElementsByTagName('tbody')[0];
        data.forEach(function(item) {
          var row = tbody.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          var cell3 = row.insertCell(2);
          var cell4 = row.insertCell(3);
          var cell5 = row.insertCell(4);
          var cell6 = row.insertCell(5);
  
          imagen = document.createElement('img');
          imagen.src = item.scr == undefined ? "{% static 'images/cotizacion_img/4.png' %}" : item.scr;
          imagen.width = 75;
          imagen.height = 75;
          cell1.appendChild(imagen);
          cell2.innerHTML = item.sku == undefined ? "" : item.sku;
          cell3.innerHTML = item.node.title == undefined ? "" : item.node.title;
          cell4.innerHTML = item.node.quantity == undefined ? "" : item.node.quantity;
          vUnit = item.node.originalUnitPrice / 1.19;
          cell5.innerHTML = item.node.originalUnitPrice == undefined ? "" : formatNumber(vUnit);
          totalItem = item.node.originalUnitPrice / 1.19 * item.node.quantity;
          cell6.innerHTML = item.node.originalUnitPrice == undefined ? "" : formatNumber(totalItem);
        });
      }

      var limit = 7;
      const rowGroups = [];
      let currentGroup = [];
      let rowCount = 0;
      for (const row of data) {
        currentGroup.push(row);
        rowCount++;
        if (rowCount >= limit) {
          rowGroups.push(currentGroup);
          currentGroup = [];
          rowCount = 0;
        }
      }
  
      if (currentGroup.length > 0) {
        rowGroups.push(currentGroup);
      }
      var divs = [];
      rowGroups.forEach((group, index) => {
        divPage = document.getElementById('cotizacion');
        if (index == 0){
            table = divPage.getElementsByClassName('product-table')[0];
            setTable(table, group);
            if (rowGroups.length > 1){
                footer = document.getElementById('footer');
                footer.remove()
            }
        }
        else {
            var divPageAdd = divPage.cloneNode(true); //clona el div
            //quita datos de cliente
            infoCustomers = divPageAdd.getElementsByClassName('info-customer');
            while (infoCustomers.length > 0) {
            infoCustomers[0].parentNode.removeChild(infoCustomers[0]);
            }//hasta aqui quita datos de cliente
            table = divPageAdd.getElementsByClassName('product-table')[0];
            var tbody = table.getElementsByTagName('tbody')[0];
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
              }
            setTable(table, group);
            divPageAdd.id = 'cotizacion_' + index.toString();
            group.forEach((row) => {
            document.body.appendChild(divPageAdd);
            });
            container = divPageAdd.getElementsByClassName('container')[0]

                if ((container.offsetHeight + 322) > 800  && (rowGroups.length == index+1)){
                    add_footer()
                }
                if (!document.getElementById('footer')){
                    add_footer()
                }
                
            }    
      });

      function add_footer() {
      container.appendChild(footer.getElementsByClassName('cont_ends')[0]);
      var divPageAdd = divPage.cloneNode(true); //clona el div
      //quita datos de cliente
      infoCustomers = divPageAdd.getElementsByClassName('info-customer');
      while (infoCustomers.length > 0) {
      infoCustomers[0].parentNode.removeChild(infoCustomers[0]);
      }//hasta aqui quita datos de cliente
      table = divPageAdd.getElementsByClassName('product-table')[0];
      table.remove()
      document.body.appendChild(divPageAdd);
      container = divPageAdd.getElementsByClassName('container')[0];
      politics = footer.getElementsByClassName('politics')[0];
      politics.style.marginTop = "60px";
      container.appendChild(politics);}
    };
</script>