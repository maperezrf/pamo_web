{% extends 'base.html' %}
{% block content %}
{% load static %}
<script src="{% static 'js/functions.js' %}"></script>
<h1 class="container text-center space">Cotizaciones</h1>
<div class = "container my-4"> 
  <div class = "row" >  
    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
      <table class="table table-striped container space"  id="cotizaciones">
        <thead >
          <tr >  
            <th scope="col" class = 'h4 text-center'># Cotizacíon</th>
            <th scope="col" class = 'h4 text-center'>Cliente</th>
            <th scope="col" class = 'h4 text-center'>Valor</th>
            <th scope="col" class = 'h4 text-center'>Fecha Creacion</th>
            <th scope="col" class = 'h4 text-center'>Detalle</th>
          </tr>
        </thead>
          {% for i in table %}
          <tr>
     
            <td class="h5 name" id = 'name'>{{i.name}}</td>
            <td class="h5">{{i.customer}}</td>
            <td class="h5"><script> document.write(formatNumber({{i.total}})) </script></td>
            <td class="h5">{{i.created_at}}</td>
            <td><button class="imprimir-btn btn btn-primary" id_draft ="{{i.id}}" data-cotizacion="cotizacion1">Ver</button></td> 
          </tr>
          {% endfor %}
        </table>
    </div>
  </div>
</div>

<script>

  let dataTable;
  let dataTableIsInitialized = false;
  
  const dataTableOptions = {
    pageLength:25,
    destroy:true,
    order: [[0, 'desc']],
    columnDefs:[{className:'text-center', targets:[0,1,2,3]}],
    language: {
      "sProcessing": "Procesando...",
      "sLengthMenu": "Mostrar _MENU_ registros por página",
      "sZeroRecords": "No se encontraron resultados",
      "sEmptyTable": "Ningún dato disponible en esta tabla",
      "sInfo": "Mostrando _START_ a _END_ de _TOTAL_ registros",
      "sInfoEmpty": "Mostrando 0 a 0 de 0 registros",
      "sInfoFiltered": "(filtrado de _MAX_ registros en total)",
      "sInfoPostFix": "",
      "sSearch": "Buscar:",
      "sUrl": "",
      "sInfoThousands": ",",
      "sLoadingRecords": "Cargando...",
      "oPaginate": {
        "sFirst": "Primero",
        "sLast": "Último",
        "sNext": "Siguiente",
        "sPrevious": "Anterior"
      },
    },
  }

  const initDataTable = async() => {
    if(dataTableIsInitialized){
      dataTable.destroy();
    }
    dataTable=$("#cotizaciones").DataTable(dataTableOptions);
    dataTableIsInitialized = true;
    console.log('inicia')
  }
  
  const botonesImprimir = document.querySelectorAll('.imprimir-btn');
  botonesImprimir.forEach((boton) => {
    boton.addEventListener('click', function() {
      console.log("{{url_base}}")
      const popup = window.open('{{url_base}}'+'/quoteprint/'+ this.getAttribute('id_draft').replace('gid://shopify/DraftOrder/','') +'/print/', '', 'width=1200,height=700'); 
    })
  })

  window.addEventListener("load", async () =>{
    await initDataTable();
  })

</script>
{% endblock %}